<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro Hand Tracker</title>

<style>
  * { box-sizing: border-box; }
  
  body {
    margin: 0;
    background: radial-gradient(circle, #1a1a2e, #0f0f1a);
    color: white;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —á—Ç–æ–±—ã –≤–∏–¥–µ–æ –∏ –∫–∞–Ω–≤–∞—Å –Ω–µ —Ä–∞–∑—ä–µ–∑–∂–∞–ª–∏—Å—å */
  #container {
    position: relative;
    width: 100%;
    max-width: 800px;
    aspect-ratio: 4/3;
    border-radius: 16px;
    box-shadow: 0 0 30px rgba(0, 255, 170, 0.2);
    overflow: hidden;
    background: #000;
  }

  video, canvas {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform: scaleX(-1); /* –ó–µ—Ä–∫–∞–ª–∏–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
  }

  /* HUD –¥–ª—è –∂–µ—Å—Ç–æ–≤ */
  #hud {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid lime;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 24px;
    font-weight: bold;
    color: lime;
    text-transform: uppercase;
    letter-spacing: 2px;
    z-index: 5;
    display: none;
    text-shadow: 0 0 10px lime;
  }

  button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
    padding: 15px 40px;
    font-size: 20px;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(45deg, #ff0055, #ff00aa);
    border: none;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 0 20px rgba(255, 0, 170, 0.5);
    transition: 0.2s;
  }

  button:hover {
    transform: translate(-50%, -50%) scale(1.05);
    box-shadow: 0 0 30px rgba(255, 0, 170, 0.8);
  }
</style>
</head>
<body>

<div id="container">
  <button id="startBtn">–í–†–£–ë–ò–¢–¨ –ö–ê–ú–ï–†–£</button>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
  <div id="hud">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const btn = document.getElementById("startBtn");
const hud = document.getElementById("hud");

// –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ñ–∏—à–∫–∏ —Å–æ —Å–ª–µ–¥–æ–º (—Ç—Ä–µ–π–ª–æ–º) —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∞–ª—å—Ü–∞
let pointerTrail = [];

btn.onclick = async () => {
  btn.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { width: 640, height: 480, facingMode: "user" }
    });
    video.srcObject = stream;
    
    // –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –ø—Ä–æ–≥—Ä—É–∑–∏–ª–æ—Å—å - —Å—Ç–∞—Ä—Ç—É–µ–º —Ç—Ä–µ–∫–∏–Ω–≥
    video.onloadedmetadata = () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      btn.style.display = "none";
      hud.style.display = "block";
      startTracking();
    };
  } catch (err) {
    alert("–ß–µ–ª, –¥–∞–π –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ! –ë–µ–∑ –Ω–µ—ë –º–∞–≥–∏–∏ –Ω–µ –±—É–¥–µ—Ç.");
    btn.innerText = "–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞";
  }
};

function startTracking() {
  const hands = new Hands({
    locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
  });

  hands.setOptions({
    maxNumHands: 2, // –¢–µ–ø–µ—Ä—å —Ç—Ä–µ–∫–∞–µ—Ç –¥–æ 2 —Ä—É–∫, –º—ã –∂–µ –Ω–µ –∂–∞–¥–Ω—ã–µ
    modelComplexity: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
  });

  hands.onResults(results => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
      for (const landmarks of results.multiHandLandmarks) {
        
        // 1. –û–¢–†–ò–°–û–í–ö–ê –°–ö–ï–õ–ï–¢–ê (—Ç–æ–ø —Ñ–∏—à–∫–∞)
        drawConnectors(ctx, landmarks, HAND_CONNECTIONS, {
          color: '#00FFea', lineWidth: 4
        });
        drawLandmarks(ctx, landmarks, {
          color: '#FF0055', lineWidth: 2, radius: 4
        });

        // 2. –§–ò–®–ö–ê: –ù–ï–û–ù–û–í–´–ô –¢–†–ï–ô–õ –ó–ê –£–ö–ê–ó–ê–¢–ï–õ–¨–ù–´–ú –ü–ê–õ–¨–¶–ï–ú (—Ç–æ—á–∫–∞ 8)
        const indexTip = landmarks[8];
        const x = indexTip.x * canvas.width;
        const y = indexTip.y * canvas.height;
        
        pointerTrail.push({x, y});
        if (pointerTrail.length > 15) pointerTrail.shift(); // –î–ª–∏–Ω–∞ —Ö–≤–æ—Å—Ç–∞

        ctx.beginPath();
        for (let i = 0; i < pointerTrail.length; i++) {
          const pt = pointerTrail[i];
          if (i === 0) ctx.moveTo(pt.x, pt.y);
          else ctx.lineTo(pt.x, pt.y);
        }
        ctx.strokeStyle = `rgba(0, 255, 234, 0.8)`;
        ctx.lineWidth = 6;
        ctx.lineCap = "round";
        ctx.stroke();

        // 3. –†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–ï –ñ–ï–°–¢–û–í
        const gesture = detectGesture(landmarks);
        hud.innerText = gesture;
        
        // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∂–µ—Å—Ç–∞ –¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã
        if (gesture === "–ö—É–ª–∞–∫ ‚úä") hud.style.color = "#ff3333";
        else if (gesture === "Peace ‚úåÔ∏è") hud.style.color = "#33ccff";
        else if (gesture === "–†–æ–∫ ü§ò") hud.style.color = "#ff00aa";
        else hud.style.color = "lime";
      }
    } else {
      pointerTrail = []; // –û—á–∏—â–∞–µ–º —Ö–≤–æ—Å—Ç, –µ—Å–ª–∏ —Ä—É–∫–∞ –ø—Ä–æ–ø–∞–ª–∞
      hud.innerText = "–†—É–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞";
      hud.style.color = "white";
    }
  });

  const camera = new Camera(video, {
    onFrame: async () => {
      await hands.send({ image: video });
    },
    width: 640,
    height: 480
  });

  camera.start();
}

// –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ—Ç–µ–∫—Ç–∞ (—á–µ—Ä–µ–∑ —Å–≥–∏–±—ã —Å—É—Å—Ç–∞–≤–æ–≤, –∞ –Ω–µ —Ç—É–ø–æ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º)
function detectGesture(landmarks) {
  // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏: –ø–æ–¥–Ω—è—Ç –ª–∏ –ø–∞–ª–µ—Ü (—Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–æ–Ω—á–∏–∫ —Å –Ω–∏–∂–Ω–∏–º —Å—É—Å—Ç–∞–≤–æ–º)
  const isUp = (tip, pip) => landmarks[tip].y < landmarks[pip].y;

  const indexUp = isUp(8, 6);
  const middleUp = isUp(12, 10);
  const ringUp = isUp(16, 14);
  const pinkyUp = isUp(20, 18);

  // –õ–æ–≥–∏–∫–∞ –∂–µ—Å—Ç–æ–≤
  if (!indexUp && !middleUp && !ringUp && !pinkyUp) return "–ö—É–ª–∞–∫ ‚úä";
  if (indexUp && middleUp && !ringUp && !pinkyUp) return "Peace ‚úåÔ∏è";
  if (indexUp && !middleUp && !ringUp && pinkyUp) return "–†–æ–∫ ü§ò";
  if (indexUp && middleUp && ringUp && pinkyUp) return "–û—Ç–∫—Ä—ã—Ç–∞—è —Ä—É–∫–∞ üñêÔ∏è";
  
  return "–¢—Ä–µ–∫–∏–Ω–≥...";
}
</script>

</body>
</html>

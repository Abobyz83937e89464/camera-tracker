<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hand Gesture Tracker</title>

<style>
body {
  margin: 0;
  background: black;
  color: white;
  text-align: center;
  font-family: Arial;
}

video, canvas {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  transform: scaleX(-1);
}

button {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  padding: 15px 25px;
  font-size: 18px;
}
</style>
</head>
<body>

<button id="startBtn">Включить камеру</button>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const btn = document.getElementById("startBtn");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let hands;

btn.onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "user" }
  });
  video.srcObject = stream;
  btn.style.display = "none";

  startTracking();
};

function startTracking() {

  hands = new Hands({
    locateFile: file => {
      return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
    }
  });

  hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
  });

  hands.onResults(results => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (results.multiHandLandmarks.length > 0) {
      const landmarks = results.multiHandLandmarks[0];

      if (isOpenHand(landmarks)) {
        const palm = landmarks[9]; // центр ладони
        const x = palm.x * canvas.width;
        const y = palm.y * canvas.height;

        ctx.strokeStyle = "lime";
        ctx.lineWidth = 4;
        ctx.strokeRect(x - 80, y - 80, 160, 160);
      }
    }
  });

  const camera = new Camera(video, {
    onFrame: async () => {
      await hands.send({ image: video });
    },
    width: 640,
    height: 480
  });

  camera.start();
}

function isOpenHand(landmarks) {

  const fingers = [
    [8, 6],   // указательный
    [12,10],  // средний
    [16,14],  // безымянный
    [20,18]   // мизинец
  ];

  let openFingers = 0;

  fingers.forEach(finger => {
    if (landmarks[finger[0]].y < landmarks[finger[1]].y) {
      openFingers++;
    }
  });

  // большой палец
  if (landmarks[4].x > landmarks[3].x) {
    openFingers++;
  }

  return openFingers === 5;
}
</script>

</body>
</html>
